import{S as tt,P as st}from"./program.2ef84f69.js";const nt=`#version 300 es

in vec3 aVertexPosition;

uniform mat4 uModelViewMatrix;
uniform mat4 uProjectionMatrix;

void main() {
  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(aVertexPosition, 1.0);
}`,it=`#version 300 es

// 全ての浮動小数点型の変数に高い精度を指定
precision highp float;

out vec4 outColor;

void main() {
  outColor = vec4(1.0, 1.0, 1.0, 1.0);
}`;class et{_gl;_program;_objects=[];constructor(t,s){this._gl=t,this._program=s}add(t){t.ibo=this.buildIBO(t.indices),t.vao=this.buildVAO();const s=this.bindVertexArray(t.vao);this.registerPositions(t),this._objects.push(t),s()}tranverse(t){for(const[s,n]of this._objects.entries())t(n,s)}buildIBO(t){const s=this._gl.createBuffer();return this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,s),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,new Int16Array(t),this._gl.STATIC_DRAW),this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,null),s}buildVAO(){return this._gl.createVertexArray()}bindVertexArray(t){return this._gl.bindVertexArray(t),()=>this._gl.bindVertexArray(null)}registerAtrribute(t,s,n){if(s<0)return;const i=this._gl.createBuffer();this._gl.bindBuffer(this._gl.ARRAY_BUFFER,i),this._gl.bufferData(this._gl.ARRAY_BUFFER,t,this._gl.STATIC_DRAW),this._gl.enableVertexAttribArray(s),this._gl.vertexAttribPointer(s,n,this._gl.FLOAT,!1,0,0),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,null)}registerPositions(t){const s=this._program.getAttributeLocation("aVertexPosition"),n=new Float32Array(t.vertices);this.registerAtrribute(n,s,3)}}class ot{_values;constructor(t){this._values=new Float32Array(t)}get values(){return this._values}get magnitude(){let t=0;for(const s of this._values)t+=s**2;return Math.sqrt(t)}toString(){return`Vector${this._values.length}(${this._values.join(", ")})`}}class rt extends ot{get x(){return this._values[0]}get y(){return this._values[1]}get z(){return this._values[2]}set x(t){this._values[0]=t}set y(t){this._values[1]=t}set z(t){this._values[2]=t}}class h extends rt{constructor(t,s,n){super([t,s,n])}add(t){return new h(this.x+t.x,this.y+t.y,this.z+t.z)}sub(t){return new h(this.x-t.x,this.y-t.y,this.z-t.z)}mulByScalar(t){return new h(this.x*t,this.y*t,this.z*t)}dotV(t){return this.x*t.x+this.y*t.y+this.z*t.z}dot(t,s,n){return this.x*t+this.y*s+this.z*n}crossV(t){const s=this.y*t.z-this.z*t.y,n=this.z*t.x-this.x*t.z,i=this.x*t.y-this.y*t.x;return new h(s,n,i)}cross(t,s,n){const i=this.y*n-this.z*s,e=this.z*t-this.x*n,o=this.x*s-this.y*t;return new h(i,e,o)}normalize(){const t=this.magnitude;return t===0?this:new h(this.x/t,this.y/t,this.z/t)}translateByMat4(t){const s=t.values[0],n=t.values[4],i=t.values[8],e=t.values[1],o=t.values[5],r=t.values[9],u=t.values[2],m=t.values[6],a=t.values[10],l=this.dot(s,n,i),_=this.dot(e,o,r),w=this.dot(u,m,a);return new h(l,_,w)}}class d{_values;constructor(t,s,n,i){this._values=new Float32Array([t,s,n,i])}static rotationAround(t,s){const n=Math.sin(s/2),i=Math.cos(s/2);return new d(t.x*n,t.y*n,t.z*n,i)}conj(){return new d(-1*this.x,-1*this.y,-1*this.z,this.w)}normalize(){const t=this.magnitude;if(t===0)return this;const s=1/t;return new d(this.x*s,this.y*s,this.z*s,this.w*s)}add(t){return new d(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)}mulByScalar(t){return new d(this.x*t,this.y*t,this.z*t,this.w*t)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}multiply(t){const s=this,n=t;return new d(s.w*n.w-s.x*n.x-s.y*n.y-s.z*n.z,s.w*n.x+s.x*n.w+s.y*n.z-s.z*n.y,s.w*n.y-s.x*n.z+s.y*n.w+s.z*n.x,s.w*n.z+s.x*n.y-s.y*n.x+s.z*n.w)}slerp(t,s){let n=this.dot(t),i=t;n<0&&(n=-n,i=t.mulByScalar(-1));const e=Math.acos(n),o=Math.sin(e),r=this.mulByScalar(Math.sin((1-s)*e)/o),u=i.mulByScalar(Math.sin(s*e)/o);return r.add(u)}get magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}get norm(){return this.magnitude}get x(){return this._values[0]}get y(){return this._values[1]}get z(){return this._values[2]}get w(){return this._values[3]}set x(t){this._values[0]=t}set y(t){this._values[1]=t}set z(t){this._values[2]=t}set w(t){this._values[3]=t}get values(){return this._values}toRotationMatrix4(){const t=this.x,s=this.y,n=this.z,i=this.w,e=1-2*s*s-2*n*n,o=2*t*s-2*i*n,r=2*t*n+2*i*s,u=0,m=2*t*s+2*i*n,a=1-2*t*t-2*n*n,l=2*s*n-2*i*t,_=0,w=2*t*n-2*i*s,f=2*s*n+2*i*t,g=1-2*t*t-2*s*s,y=0,x=0,p=0,A=0,z=1;return new c(e,m,w,x,o,a,f,p,r,l,g,A,u,_,y,z)}toRotatedVector3(t,s,n){const i=this,e=this.conj(),o=new d(t,s,n,0),r=e.multiply(o).multiply(i);return new h(r.x,r.y,r.z)}toString(){return`Quaternion(${this.x}, ${this.y}, ${this.z}, ${this.w})`}}class c{#t;constructor(t=1,s=0,n=0,i=0,e=0,o=1,r=0,u=0,m=0,a=0,l=1,_=0,w=0,f=0,g=0,y=1){return this.#t=new Float32Array([t,s,n,i,e,o,r,u,m,a,l,_,w,f,g,y]),this}static identity(){return new c}static translation(t,s,n){return new c(1,0,0,0,0,1,0,0,0,0,1,0,t,s,n,1)}static scaling(t,s,n){return new c(t,0,0,0,0,s,0,0,0,0,n,0,0,0,0,1)}static rotationX(t){const s=Math.sin(t),n=Math.cos(t);return new c(1,0,0,0,0,n,s,0,0,-s,n,0,0,0,0,1)}static rotationY(t){const s=Math.sin(t),n=Math.cos(t);return new c(n,0,-s,0,0,1,0,0,s,0,n,0,0,0,0,1)}static rotationZ(t){const s=Math.sin(t),n=Math.cos(t);return new c(n,s,0,0,-s,n,0,0,0,0,1,0,0,0,0,1)}static rotationAround(t,s){return d.rotationAround(t,s).toRotationMatrix4()}static lookAt(t,s,n){const i=t.sub(s).normalize(),e=n.crossV(i).normalize(),o=i.crossV(e).normalize();return new c(e.x,o.x,i.x,0,e.y,o.y,i.y,0,e.z,o.z,i.z,0,-t.dotV(e),-t.dotV(o),-t.dotV(i),1)}static orthographic(t){const s=t.top,n=t.bottom,i=t.left,e=t.right,o=t.near,r=t.far;return new c(2/(e-i),0,0,0,0,2/(s-n),0,0,0,0,-2/(r-o),0,-(e+i)/(e-i),-(s+n)/(s-n),-(r+o)/(r-o),1)}static frustum(t,s,n,i,e,o){return new c(2*e/(i-n),0,0,0,0,2*e/(t-s),0,0,(i+n)/(i-n),(t+s)/(t-s),-(o+e)/(o-e),-1,0,0,-2*o*e/(o-e),0)}static perspective(t,s,n,i){const e=n*Math.tan(t*.5),o=e*2,r=s*o,u=-.5*r,m=u+r,a=e-o;return c.frustum(e,a,u,m,n,i)}mulByMatrix4(t){const s=this.#t[0],n=this.#t[4],i=this.#t[8],e=this.#t[12],o=this.#t[1],r=this.#t[5],u=this.#t[9],m=this.#t[13],a=this.#t[2],l=this.#t[6],_=this.#t[10],w=this.#t[14],f=this.#t[3],g=this.#t[7],y=this.#t[11],x=this.#t[15],p=t.values[0],A=t.values[4],z=t.values[8],M=t.values[12],B=t.values[1],R=t.values[5],V=t.values[9],E=t.values[13],F=t.values[2],b=t.values[6],P=t.values[10],S=t.values[14],U=t.values[3],T=t.values[7],k=t.values[11],N=t.values[15],I=s*p+n*B+i*F+e*U,L=s*A+n*R+i*b+e*T,q=s*z+n*V+i*P+e*k,C=s*M+n*E+i*S+e*N,D=o*p+r*B+u*F+m*U,O=o*A+r*R+u*b+m*T,$=o*z+r*V+u*P+m*k,X=o*M+r*E+u*S+m*N,Z=a*p+l*B+_*F+w*U,j=a*A+l*R+_*b+w*T,G=a*z+l*V+_*P+w*k,H=a*M+l*E+_*S+w*N,W=f*p+g*B+y*F+x*U,J=f*A+g*R+y*b+x*T,K=f*z+g*V+y*P+x*k,Q=f*M+g*E+y*S+x*N;return new c(I,D,Z,W,L,O,j,J,q,$,G,K,C,X,H,Q)}inverse(){const t=this.#t;let s=[];s[0]=t[5]*t[10]*t[15]-t[5]*t[11]*t[14]-t[9]*t[6]*t[15]+t[9]*t[7]*t[14]+t[13]*t[6]*t[11]-t[13]*t[7]*t[10],s[4]=-t[4]*t[10]*t[15]+t[4]*t[11]*t[14]+t[8]*t[6]*t[15]-t[8]*t[7]*t[14]-t[12]*t[6]*t[11]+t[12]*t[7]*t[10],s[8]=t[4]*t[9]*t[15]-t[4]*t[11]*t[13]-t[8]*t[5]*t[15]+t[8]*t[7]*t[13]+t[12]*t[5]*t[11]-t[12]*t[7]*t[9],s[12]=-t[4]*t[9]*t[14]+t[4]*t[10]*t[13]+t[8]*t[5]*t[14]-t[8]*t[6]*t[13]-t[12]*t[5]*t[10]+t[12]*t[6]*t[9],s[1]=-t[1]*t[10]*t[15]+t[1]*t[11]*t[14]+t[9]*t[2]*t[15]-t[9]*t[3]*t[14]-t[13]*t[2]*t[11]+t[13]*t[3]*t[10],s[5]=t[0]*t[10]*t[15]-t[0]*t[11]*t[14]-t[8]*t[2]*t[15]+t[8]*t[3]*t[14]+t[12]*t[2]*t[11]-t[12]*t[3]*t[10],s[9]=-t[0]*t[9]*t[15]+t[0]*t[11]*t[13]+t[8]*t[1]*t[15]-t[8]*t[3]*t[13]-t[12]*t[1]*t[11]+t[12]*t[3]*t[9],s[13]=t[0]*t[9]*t[14]-t[0]*t[10]*t[13]-t[8]*t[1]*t[14]+t[8]*t[2]*t[13]+t[12]*t[1]*t[10]-t[12]*t[2]*t[9],s[2]=t[1]*t[6]*t[15]-t[1]*t[7]*t[14]-t[5]*t[2]*t[15]+t[5]*t[3]*t[14]+t[13]*t[2]*t[7]-t[13]*t[3]*t[6],s[6]=-t[0]*t[6]*t[15]+t[0]*t[7]*t[14]+t[4]*t[2]*t[15]-t[4]*t[3]*t[14]-t[12]*t[2]*t[7]+t[12]*t[3]*t[6],s[10]=t[0]*t[5]*t[15]-t[0]*t[7]*t[13]-t[4]*t[1]*t[15]+t[4]*t[3]*t[13]+t[12]*t[1]*t[7]-t[12]*t[3]*t[5],s[14]=-t[0]*t[5]*t[14]+t[0]*t[6]*t[13]+t[4]*t[1]*t[14]-t[4]*t[2]*t[13]-t[12]*t[1]*t[6]+t[12]*t[2]*t[5],s[3]=-t[1]*t[6]*t[11]+t[1]*t[7]*t[10]+t[5]*t[2]*t[11]-t[5]*t[3]*t[10]-t[9]*t[2]*t[7]+t[9]*t[3]*t[6],s[7]=t[0]*t[6]*t[11]-t[0]*t[7]*t[10]-t[4]*t[2]*t[11]+t[4]*t[3]*t[10]+t[8]*t[2]*t[7]-t[8]*t[3]*t[6],s[11]=-t[0]*t[5]*t[11]+t[0]*t[7]*t[9]+t[4]*t[1]*t[11]-t[4]*t[3]*t[9]-t[8]*t[1]*t[7]+t[8]*t[3]*t[5],s[15]=t[0]*t[5]*t[10]-t[0]*t[6]*t[9]-t[4]*t[1]*t[10]+t[4]*t[2]*t[9]+t[8]*t[1]*t[6]-t[8]*t[2]*t[5];let n=t[0]*s[0]+t[1]*s[4]+t[2]*s[8]+t[3]*s[12];return n===0?this:(n=1/n,s=s.map(i=>i*n),new c(...s))}transpose(){const t=this.#t;let s=[];return s[0]=t[0],s[1]=t[4],s[2]=t[8],s[3]=t[12],s[4]=t[1],s[5]=t[5],s[6]=t[9],s[7]=t[13],s[8]=t[2],s[9]=t[6],s[10]=t[10],s[11]=t[14],s[12]=t[3],s[13]=t[7],s[14]=t[11],s[15]=t[15],new c(...s)}translate(t,s,n){const i=c.translation(t,s,n);return this.mulByMatrix4(i)}scale(t,s,n){const i=c.scaling(t,s,n);return this.mulByMatrix4(i)}rotateX(t){const s=c.rotationX(t);return this.mulByMatrix4(s)}rotateY(t){const s=c.rotationY(t);return this.mulByMatrix4(s)}rotateZ(t){const s=c.rotationZ(t);return this.mulByMatrix4(s)}rotateAround(t,s){const n=c.rotationAround(t,s);return this.mulByMatrix4(n)}get values(){return this.#t}toString(){return this.#t.toString()}}const at=v=>v*Math.PI/180,Y={from:at};class ct{_position;_focusPoint;_up;_right;_normal;_lookAt;_azimuth;_elevation;_fov;_near;_far;constructor(){this._position=new h(0,0,0),this._focusPoint=new h(0,0,0),this._right=new h(1,0,0),this._up=new h(0,1,0),this._normal=new h(0,0,1),this._lookAt=new c,this._azimuth=0,this._elevation=0,this._fov=45,this._near=.1,this._far=1e4}set position([t,s,n]){this._position=new h(t,s,n)}set focusPoint([t,s,n]){this._focusPoint=new h(t,s,n)}set fov(t){this._fov=t}set near(t){this._near=t}set far(t){this._far=t}get fov(){return this._fov}get near(){return this._near}get far(){return this._far}updateOrientation(){this._right=new h(1,0,0).translateByMat4(this._lookAt),this._up=new h(0,1,0).translateByMat4(this._lookAt),this._normal=new h(0,0,1).translateByMat4(this._lookAt)}update(){const{x:t,y:s,z:n}=this._position,i=this._lookAt.rotateY(Y.from(this._azimuth)).rotateX(Y.from(this._elevation)).translate(t,s,n);this._lookAt=i,this.updateOrientation()}get viewTransform(){return this._lookAt.inverse()}}class ht{_gl;_program;_camera;_canvas;_modelViewMatrix;_projectionMatrix;_normalMatrix;stack;constructor(t,s,n,i){this._gl=t,this._program=s,this._camera=n,this._canvas=i,this._modelViewMatrix=this.calcModelView(),this._projectionMatrix=this.calcPerspective(),this._normalMatrix=this.calcNormal(),this.stack=[]}calcModelView(){return this._camera.viewTransform}calcNormal(){return this._modelViewMatrix.inverse().transpose()}calcPerspective(){const{fov:t,near:s,far:n}=this._camera,i=this._canvas.width/this._canvas.height;return c.perspective(t,i,s,n)}updateModelView(){this._modelViewMatrix=this.calcModelView()}updateNormal(){this._normalMatrix=this.calcNormal()}updatePerspective(){this._projectionMatrix=this.calcPerspective()}setUniformMatrix4fv(t,s){this._gl.uniformMatrix4fv(this._program.getUniformLocation(t),!1,s.values)}setMatrixUniforms(){this.updateNormal(),this.setUniformMatrix4fv("uModelViewMatrix",this._modelViewMatrix),this.setUniformMatrix4fv("uProjectionMatrix",this._projectionMatrix),this.setUniformMatrix4fv("uNormalMatrix",this._normalMatrix)}push(){this.stack.push(this._modelViewMatrix)}pop(){if(!this.stack.length)return;const t=this.stack.pop();t&&(this._modelViewMatrix=t)}}window.onload=()=>{const v=new tt("gl-canvas"),t=v.canvas,s=v.gl;if(!t||!s)return;let n,i,e;const o=()=>{v.autoResize(()=>v.fitScreenSquare()),s.clearColor(0,0,0,1),s.clearDepth(1);const a=new st(s,nt,it),l=["aVertexPosition"],_=["uModelViewMatrix","uProjectionMatrix"];a.load(l,_),n=new et(s,a),i=new ct,i.position=[0,1,3],i.fov=90,i.far=100,i.update(),e=new ht(s,a,i,t),e.setMatrixUniforms()},r=()=>{const a=[0,1,0,1,0,0,-1,0,0],l=[0,1,2];n.add({vertices:a,indices:l})},u=()=>{s.viewport(0,0,s.canvas.width,s.canvas.height),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),n.tranverse(a=>{a.hidden||(s.bindVertexArray(a.vao??null),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,a.ibo??null),s.drawElements(s.TRIANGLES,a.indices.length,s.UNSIGNED_SHORT,0),s.bindVertexArray(null),s.bindBuffer(s.ARRAY_BUFFER,null),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,null))})};(()=>{o(),r(),u()})()};
