<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Mono&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css" integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0" crossorigin="anonymous">
    <link href="/prism-pastelfairy.css" rel="stylesheet">
    <title>バッファを使わずにキャンバスを覆う三角形を描く</title>
  <link rel="stylesheet" href="/_astro/_slug_.c93fc5fd.css" /><script type="module">
</script></head>
  <body>
    <h1 id="バッファを使わずにキャンバスを覆う三角形を描く">バッファを使わずにキャンバスを覆う三角形を描く</h1>
<p>GLSL（ESSL）の練習では、キャンバス一面になんだかんだ描きたい。</p>
<p>つまり、フラグメントシェーダで塗りつぶす対象の図形をキャンバス全体に広げたい。</p>
<p>しかし、そのためだけに VBO をつくる等、WebGL コードが長くなるのはめんどくさいので、最初から頂点シェーダでキャンバスを覆う図形の頂点を計算させる。</p>
<p>WebGL 側ではほぼ<code>gl.drawArrays(gl.TRIANGLE_FAN, 0, 3)</code>を呼び出すだけ。</p>
<p>…というようなことを実現するスニペットが gist に転がっていた。</p>
<ul>
<li><a href="https://gist.github.com/strangerintheq/27b8fc4e53432d8b9284364713ce8608">Render full screen triangle in WebGL 2</a></li>
</ul>
<p>頂点シェーダだけ引用。（<code>gl_VertexID</code>やビット演算を使っている時点で WebGL1 では動かない）</p>
<pre class="language-glsl"><code class="language-glsl"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">300</span> es</span></span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">float</span> x <span class="token operator">=</span> <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token punctuation">(</span>gl_VertexID <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">float</span> y <span class="token operator">=</span> <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token punctuation">(</span>gl_VertexID <span class="token operator">&amp;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl_Position <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token number">1.0</span><span class="token punctuation">,</span> y <span class="token operator">-</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>このコードにより、最終的に<code>(-1, -1)</code>, <code>(1, -1)</code>, <code>(-1, 1)</code>, <code>(1, 1)</code>の 4 点を結ぶ矩形が描かれることになる。（その矩形上に何を描くかは、フラグメントシェーダ次第。）</p>
<p>ビット演算の思考練習も兼ねて、この謎めいた頂点シェーダがどういう原理でその 4 点を導くのか、ロジックを追ってみる。</p>
<h2 id="gl_vertexid">gl_VertexID</h2>
<p><code>gl_VertexID</code>は、現在の実行対象となっている頂点のインデックス。</p>
<ul>
<li><a href="https://wgld.org/d/webgl2/w008.html">gl_VertexID と gl_InstanceID</a></li>
</ul>
<p><code>gl.drawElements</code>でインデックスを指定している場合は、その指定された番号。</p>
<p><code>gl.drawArrays</code>でインデックスなしで描画している場合は、これまで処理された頂点の数、つまり、処理された順に勝手に振られた連番。</p>
<ul>
<li><a href="https://learnopengl.com/Advanced-OpenGL/Advanced-GLSL">Advanced GLSL</a></li>
</ul>
<p>今回の場合は、取りうる<code>gl_VertexID</code>の値は <code>0</code>, <code>1</code>, <code>2</code>, <code>3</code>。</p>
<h2 id="and-演算">AND 演算</h2>
<p>同じ桁を見比べたときに、両方が<code>1</code>なら<code>1</code>、そうでなければ<code>0</code>。</p>
<pre class="language-glsl"><code class="language-glsl"><span class="token comment">// gl_VertexID = 0 の場合</span>
<span class="token punctuation">(</span>gl_VertexID <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0000</span> <span class="token operator">&amp;</span> <span class="token number">0001</span> <span class="token operator">=</span> <span class="token number">0000</span>
<span class="token punctuation">(</span>gl_VertexID <span class="token operator">&amp;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0000</span> <span class="token operator">&amp;</span> <span class="token number">0010</span> <span class="token operator">=</span> <span class="token number">0000</span>

<span class="token comment">// gl_VertexID = 1 の場合</span>
<span class="token punctuation">(</span>gl_VertexID <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0001</span> <span class="token operator">&amp;</span> <span class="token number">0001</span> <span class="token operator">=</span> <span class="token number">0001</span>
<span class="token punctuation">(</span>gl_VertexID <span class="token operator">&amp;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0001</span> <span class="token operator">&amp;</span> <span class="token number">0010</span> <span class="token operator">=</span> <span class="token number">0000</span>

<span class="token comment">// gl_VertexID = 2 の場合</span>
<span class="token punctuation">(</span>gl_VertexID <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0010</span> <span class="token operator">&amp;</span> <span class="token number">0001</span> <span class="token operator">=</span> <span class="token number">0000</span>
<span class="token punctuation">(</span>gl_VertexID <span class="token operator">&amp;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0010</span> <span class="token operator">&amp;</span> <span class="token number">0010</span> <span class="token operator">=</span> <span class="token number">0010</span>

<span class="token comment">// gl_VertexID = 3 の場合</span>
<span class="token punctuation">(</span>gl_VertexID <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0011</span> <span class="token operator">&amp;</span> <span class="token number">0001</span> <span class="token operator">=</span> <span class="token number">0001</span>
<span class="token punctuation">(</span>gl_VertexID <span class="token operator">&amp;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0011</span> <span class="token operator">&amp;</span> <span class="token number">0010</span> <span class="token operator">=</span> <span class="token number">0010</span></code></pre>
<h2 id="左シフト">左シフト</h2>
<pre class="language-glsl"><code class="language-glsl"><span class="token comment">// gl_VertexID = 0 の場合</span>
<span class="token punctuation">(</span>gl_VertexID <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">0000</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">0000</span>
<span class="token punctuation">(</span>gl_VertexID <span class="token operator">&amp;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">0000</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">0000</span>

<span class="token comment">// gl_VertexID = 1 の場合</span>
<span class="token punctuation">(</span>gl_VertexID <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">0001</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">0100</span>
<span class="token punctuation">(</span>gl_VertexID <span class="token operator">&amp;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">0000</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">0000</span>

<span class="token comment">// gl_VertexID = 2 の場合</span>
<span class="token punctuation">(</span>gl_VertexID <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">0000</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">0000</span>
<span class="token punctuation">(</span>gl_VertexID <span class="token operator">&amp;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">0010</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">0100</span>

<span class="token comment">// gl_VertexID = 3 の場合</span>
<span class="token punctuation">(</span>gl_VertexID <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">0001</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">0100</span>
<span class="token punctuation">(</span>gl_VertexID <span class="token operator">&amp;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">0010</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">0100</span></code></pre>
<h2 id="float">float</h2>
<h3 id="ビット列フル表示">ビット列フル表示</h3>
<p>ここまで、簡略化のために上位 4 ビットだけを表示してきた。</p>
<p>float 型に変換した結果、どんな値になるかを探るために、32bit フル表示すると、0100 はこうなる。</p>
<pre class="language-plaintext"><code class="language-plaintext">01000000000000000000000000000000</code></pre>
<p><a href="https://tools.m-bsys.com/calculators/ieee754.php">浮動小数点数内部表現シミュレーター</a>で可視化すると、こんな感じ。</p>
<p><img src="/articles/render-full-screen-trinangle-in-wegbl2/float-2.png" alt=""/></p>
<h3 id="浮動小数点数そもそも論">浮動小数点数そもそも論</h3>
<p>浮動小数点数は、例えば <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mn>0.00025</mn></mrow><annotation encoding="application/x-tex">-0.00025</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em"></span><span class="mord">−</span><span class="mord">0.00025</span></span></span></span></span> を <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mn>0.25</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mrow><mo>−</mo><mn>3</mn></mrow></msup></mrow><annotation encoding="application/x-tex">-0.25 \times 10^{-3}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em"></span><span class="mord">−</span><span class="mord">0.25</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.8141em"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span></span></span></span> のように、指数表記で数値を表現する方法。</p>
<p>このとき、<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>25</mn></mrow><annotation encoding="application/x-tex">25</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">25</span></span></span></span></span> を仮数部、<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>10</mn></mrow><annotation encoding="application/x-tex">10</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">10</span></span></span></span></span> を基数、<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">-3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em"></span><span class="mord">−</span><span class="mord">3</span></span></span></span></span> を指数部と呼ぶ。</p>
<p>仮数部の最上位桁は 0 以外でなければならない。つまり、<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mn>0.025</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mrow><mo>−</mo><mn>2</mn></mrow></msup></mrow><annotation encoding="application/x-tex">-0.025 \times 10^{-2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em"></span><span class="mord">−</span><span class="mord">0.025</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.8141em"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span> とかはダメ。</p>
<p>コンピュータで扱う数字は 2 進数なので、以降、基数は<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">2</span></span></span></span></span> とする前提で話を進める。</p>
<p>このような浮動小数点数をビット列でどう表すかというと、まあ形式はいろいろあるが、IEEE754 形式の float 型は、左から</p>
<ul>
<li>仮数部の符号：1 ビット（正なら 0、負なら 1）</li>
<li>指数部：8 ビット（2 進数表記）</li>
<li>仮数部：23 ビット（2 進数表記）</li>
</ul>
<p>という内訳の 32 ビットで表す。</p>
<h4 id="指数部">指数部</h4>
<p>指数部は 8 ビットあるので、00000000（10 進数の 0）から 11111111（10 進数の 255）までを表すことができる。
が、問題は、指数は負の数である場合もあるということだ。</p>
<p>そこで、0 ~ 255 のちょうど真ん中である 127 という数値を原点とし、</p>
<ul>
<li>指数部が 00000000 の場合、実際の指数は-127</li>
<li>指数部が 11111111 の場合、実際の指数は 128</li>
</ul>
<p>という対応づけをすることで、指数が負の数の場合もカバーできるようにする。</p>
<p>つまり、<strong>実際の指数 = 指数部ビット列を 10 進数表記した値 - 127</strong>だ。</p>
<h4 id="仮数部">仮数部</h4>
<p>2 進数では、0 と 1 の組み合わせであらゆる数値を表現するため、先ほど書いた「仮数部の最上位桁は 0 以外でなければならない」という規則に則ると、仮数部の最上位桁は必ず 1 になる。</p>
<p>このわかりきっている 1 のために 1 ビットを使うのは勿体無いということで、この部分は仮数部ビット列にはあえて書かない。</p>
<p>このような都合から、IEEE754 形式では、<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.</mn><mi>M</mi><mo>×</mo><msup><mn>2</mn><mi>N</mi></msup></mrow><annotation encoding="application/x-tex">0.M \times 2^N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em"></span><span class="mord">0.</span><span class="mord mathnormal" style="margin-right:0.10903em">M</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.8413em"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em">N</span></span></span></span></span></span></span></span></span></span></span></span> という形式ではなく、<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1.</mn><mi>M</mi><mo>×</mo><msup><mn>2</mn><mi>N</mi></msup></mrow><annotation encoding="application/x-tex">1.M \times 2^N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em"></span><span class="mord">1.</span><span class="mord mathnormal" style="margin-right:0.10903em">M</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.8413em"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em">N</span></span></span></span></span></span></span></span></span></span></span></span>という形式で表すことにしている。</p>
<p>そして、この <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.10903em">M</span></span></span></span></span> の部分を 2 進数表記したものが、仮数部のビット列として格納される。</p>
<h3 id="0100-の正体">0100 の正体</h3>
<p>前提はこれで十分。では、float 型の 01000000000000000000000000000000 は何の数値を表すのか。</p>
<ul>
<li>符号：0</li>
<li>指数部：10000000</li>
<li>仮数部：00000000000000000000000</li>
</ul>
<p>まず符号が 0 なので、正の数である。</p>
<p>指数部は 10000000 だが、これは 10 進数表記すると 128。127 を引いて、1 が実際の指数だとわかる。</p>
<p>仮数部は紛れもなく 0 だが、これは <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1.</mn><mi>M</mi></mrow><annotation encoding="application/x-tex">1.M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord">1.</span><span class="mord mathnormal" style="margin-right:0.10903em">M</span></span></span></span></span> の小数部分 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.10903em">M</span></span></span></span></span> に過ぎないので実際の仮数は 1.0 だ。</p>
<p>つまり、<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1.0</mn><mo>×</mo><msup><mn>2</mn><mn>1</mn></msup><mo>=</mo><mn>2.0</mn></mrow><annotation encoding="application/x-tex">1.0 \times 2^1 = 2.0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em"></span><span class="mord">1.0</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.8141em"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">2.0</span></span></span></span></span> となる。</p>
<h2 id="11-1-111範囲に収める"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mo>−</mo><mn>1</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[-1, 1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">[</span><span class="mord">−</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span></span>範囲に収める</h2>
<p>ビット列 0100 が表す数値は 2 なので、各場合の x, y の数値は、次のように[0, 2]範囲の整数の組み合わせとなる。</p>
<pre class="language-glsl"><code class="language-glsl"><span class="token comment">// gl_VertexID = 0 の場合</span>
x <span class="token operator">=</span> <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token punctuation">(</span>gl_VertexID <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">// ビット列0000</span>
y <span class="token operator">=</span> <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token punctuation">(</span>gl_VertexID <span class="token operator">&amp;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">// ビット列0000</span>

<span class="token comment">// gl_VertexID = 1 の場合</span>
x <span class="token operator">=</span> <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token punctuation">(</span>gl_VertexID <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2</span> <span class="token comment">// ビット列0100</span>
y <span class="token operator">=</span> <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token punctuation">(</span>gl_VertexID <span class="token operator">&amp;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">// ビット列0000</span>

<span class="token comment">// gl_VertexID = 2 の場合</span>
x <span class="token operator">=</span> <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token punctuation">(</span>gl_VertexID <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">// ビット列0000</span>
y <span class="token operator">=</span> <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token punctuation">(</span>gl_VertexID <span class="token operator">&amp;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2</span> <span class="token comment">// ビット列0100</span>

<span class="token comment">// gl_VertexID = 3 の場合</span>
x <span class="token operator">=</span> <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token punctuation">(</span>gl_VertexID <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2</span> <span class="token comment">// ビット列0100</span>
y <span class="token operator">=</span> <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token punctuation">(</span>gl_VertexID <span class="token operator">&amp;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2</span> <span class="token comment">// ビット列0100</span></code></pre>
<p>これら x, y から 1.0 を引くことで、<code>gl_VertexID</code>の値に応じて、それぞれ<code>(-1, -1)</code>, <code>(1, -1)</code>, <code>(-1, 1)</code>, <code>(1, 1)</code>という座標が得られることになる。</p>
<pre class="language-glsl"><code class="language-glsl">gl_Position <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token number">1.0</span><span class="token punctuation">,</span> y <span class="token operator">-</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2 id="参考">参考</h2>
<ul>
<li><a href="https://marina.sys.wakayama-u.ac.jp/~tokoi/?date=20160831">床井研究室 - 矩形の描き方</a></li>
<li><a href="http://www.rtpro.yamaha.co.jp/RT/docs/misc/number-table.html">10 進数/16 進数/2 進数の変換テーブル</a></li>
</ul>
  </body></html>