---
title: メッシュ
category: CG
---

## 三角形メッシュ

細かい線分によって曲線を近似できるように、三角形によって曲面を近似することができる。

### なぜ三角形？

三角形は、

- 最も単純なポリゴン（頂点が3つ未満では、面にならない）
- 常に平面となる（頂点が4つ以上では、必ずしも平面にはならない）
- ほとんどの変換で三角形のまま

だから。

## テッセレーション

表面を個別のポリゴン（**クワッド**と呼ばれる四辺形か、三角形）の集まりに分割する処理。

### 問題点

テッセレーションのレベルが固定されると、特にオブジェクトがカメラに近いときには、輪郭の**エッジ**が角ばって見える。

## 回転順序とカリング

三角形は、3つの頂点の位置ベクトル$\bold{p}_1$, $\bold{p}_2$, $\bold{p}_3$によって定義される。

三角形の辺は、それを挟む2つの頂点の位置ベクトルの差によって定義される。

$$
\bold{e}_{12} = \bold{p}_2 - \bold{p}_1 \\
\bold{e}_{23} = \bold{p}_3 - \bold{p}_2 \\
\bold{e}_{13} = \bold{p}_1 - \bold{p}_3
$$

任意の2辺のクロス積を正規化することで、単位**面法線ベクトル**$\bold{N}$が定義される。

$$
\bold{N} = \frac{\bold{e}_{12} \times \bold{e}_{13}}{|\bold{e}_{12} \times \bold{e}_{13}|}
$$

面法線ベクトルの向きを知るためには、三角形の前面と背面を定義する必要がある。

面法線ベクトルは外積なので、回転順序を指定すれば簡単に定義できる。

- 時計回り（clockwise, CW）
- 反時計回り（counterclockwise, CCW）

多くのグラフィックスAPIでは、回転順序に基づいて、背面側の三角形を**カリング**することができる。
これにより、見えない三角形を描画せずに済む。

## 三角形リスト

頂点を3つのグループに分けて、その3つの組み合わせそれぞれが1つの三角形に対応するようにリスト化することで、簡単にメッシュを定義することができる。

## インデックス付き三角形リスト

三角形リストの頂点の多くは何度も繰り返し使われている。これはメモリの浪費になる。

インデックス付き三角形リストでは、頂点のリストと三角形のリストを分けて管理することで、メモリの使用量を減らすことができる。

1. 頂点を一度、重複がないようにリスト化
2. 三角形を構成する3つの頂点の組（インデックス）を定義

## ストリップとファン

インデックスバッファを使うことなく、頂点の重複をある程度減少させるデータ構造。

### ストリップ

1. 最初の3つの頂点が最初の三角形を定義する
2. 以降の頂点はそれぞれ、直前の2つの頂点と新しい頂点で三角形を定義する

回転順序に一貫性を持たせるために、直前の隣接する2つの頂点は、新しい三角形を形成するたびに位置を入れ替える。

頂点が$V_0$, $V_1$, $V_2$, $V_3$, $V_4$, $V_5$の順に並んでいるとき、三角形は次のように定義される。

- 0, 1, 2
- 1, 3, 2
- 2, 3, 4
- 3, 5, 4

### ファン

1. 最初の3つの頂点が最初の三角形を定義する
2. 以降の頂点は、直前の頂点とファンの最初の頂点で三角形を定義する

頂点が$V_0$, $V_1$, $V_2$, $V_3$, $V_4$の順に並んでいるとき、三角形は次のように定義される。

- 0, 1, 2
- 0, 2, 3
- 0, 3, 4

## 頂点の位置ベクトル

頂点の位置ベクトルは、**モデル空間**（**ローカル空間**、**オブジェクト空間**）と呼ばれる局所的な座標系に関する相対位置で定義される。

通常は、

- 原点は、オブジェクトの中心とする
- 軸は、モデルに対して自然な「前」、「上」、「右」（「左」）の方向に指定する
